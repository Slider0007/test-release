<!DOCTYPE html>
<html lang="en" xml:lang="en"> 
<head>
	<meta charset="UTF-8">
	<title>Info</title>

	<style>
		h1 {font-size: 1.8em;}
		h2 {font-size: 1.5em; margin-block-start: 0.0em; margin-block-end: 0.2em;}
		h3 {font-size: 16px; background-color: lightgray; padding: 5px; margin: 10px 0px 3px 0px;}
		p {font-size: 1em;}

		body, html {
			font-size: 100%;
			text-size-adjust: 100%;
			-webkit-text-size-adjust: 100%;
		}

		th {
			vertical-align: middle;
			text-align: left;
			font-size: 1em;
			background-color: lightgray;
			padding: 5px;
		}

		td {
			padding: 5px 5px 5px 5px;
			border-width: 1px;
			border-color: rgb(240, 240, 240);
		}

		output {
			padding-left:5px;
		}

		.badge-success {
			color: #fff;
			background-color: #28a745;
		}

		.badge-warning {
			color: #212529;
			background-color: #ffc107;
		}

		.badge-error {
			color: #fff;
			background-color: #dc3545;
		}

		.badge-disabled {
			color: #fff;
			background-color: #646363;
		}

		.badge {
			padding: 3px 5px;
			font-size: 85%;
			font-weight: 700;
			line-height: 1;
			text-align: center;
			white-space: nowrap;
			vertical-align: baseline;
			border-radius: .25rem;
		}

		table {
			width: 660px;
			table-layout: fixed;
			border-collapse:collapse;
			margin-block-start: 10px;
		}
	</style>

	<script src="common.js?v=$COMMIT_HASH"></script> 
</head>

<body style="font-family: arial; padding: 0px 10px; width:660px; max-width:660px;">
	<h2>System Info</h2>
	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>
			<h3>Process</h3>
		</tr>
		<tr>
			<td>Process Status</td>
			<td class="td-badge">
				<output class="badge" id="process_status"></output>
			</td>
		</tr>
		<tr>
			<td>Process Interval</td>
			<td>
				<output id="process_interval"></output>
			</td>
		</tr>
		<tr>
			<td>Process Time</td>
			<td>
				<output id="process_time"></output>
			</td>
		</tr>
		<tr>
			<td>Cycle Counter</td>
			<td>
				<output id="cycle_counter"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Services</h3>
		</tr>
		<tr>
			<td>Data Logging (SD Card) </td>	
			<td class="td-badge">
				<output class="badge" id="datalogging_sdcard_status"></output>
			</td>
		</tr>
		<tr>
			<td>MQTT</td>	
			<td class="td-badge">
				<output class="badge" id="mqtt_status"></output>
			</td>
		</tr>
		<tr>
			<td>InfluxDB v1.x</td>	
			<td class="td-badge">
				<output class="badge" id="influxdbv1_status"></output>
			</td>
		</tr>
		<tr>
			<td>InfluxDB v2.x</td>	
			<td class="td-badge">
				<output class="badge" id="influxdbv2_status"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Time</h3>
		</tr>
		<tr>
			<td>Time Sync (NTP)</td>
			<td class="td-badge">
				<output class="badge" id="ntp_syncstatus"></output>
			</td>
		</tr>
		<tr>
			<td>Start Time</td>
			<td>
				<output id="device_starttime"></output>
			</td>
		</tr>
		<tr>
			<td>Current Time</td>
			<td>
				<output id="current_time"></output>
			</td>
		</tr>
		<tr>
			<td>Device Uptime</td>
			<td>
				<output id="device_uptime"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Network</h3>
		</tr>
		<tr>
			<td>WLAN Status</td>	
			<td class="td-badge">
				<output class="badge" id="wlan_status"></output>
			</td>
		</tr>
		<tr>
			<td>WLAN Name (SSID)</td>	
			<td>
				<output id="wlan_ssid"></output>
			</td>
		</tr>
		<tr>
			<td>WLAN Signal (RSSI)</td>	
			<td>
				<output id="wlan_rssi"></output>
			</td>
		</tr>
		<tr>
			<td>MAC Address</td>	
			<td>
				<output id="mac_address"></output>
			</td>
		</tr>
		<tr>
			<td>Network Configuration</td>	
			<td>
				<output id="network_config"></output>
			</td>
		</tr>
		<tr>
			<td>IPv4 Address</td>	
			<td>
				<output id="ipv4_address"></output>
			</td>
		</tr>
		<tr>
			<td>Netmask Address</td>	
			<td>
				<output id="netmask_address"></output>
			</td>
		</tr>
		<tr>
			<td>Gateway Address</td>	
			<td>
				<output id="gateway_address"></output>
			</td>
		</tr>
		<tr>
			<td>DNS Address</td>	
			<td>
				<output id="dns_address"></output>
			</td>
		</tr>
		<tr>
			<td>Hostname</td>
			<td>
				<output id="hostname"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Device</h3>
		</tr>
		<tr>
			<td>Board Type</td>
			<td>
				<output id="board_type"></output>
			</td>
		</tr>
		<tr>
			<td>SOC Model</td>
			<td>
				<output id="chip_model"></output>
			</td>
		</tr>
		<tr>
			<td>Cores</td>
			<td>
				<output id="chip_cores"></output>
			</td>
		</tr>
		<tr>
			<td>Revision</td>
			<td>
				<output id="chip_revision"></output>
			</td>
		</tr>
		<tr>
			<td>Frequency</td>
			<td>
				<output id="chip_frequency"></output>
			</td>
		</tr>
		<tr>
			<td>Temperature</td>
			<td>
				<output id="chip_temp"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Camera</h3>
		</tr>
		<tr>
			<td>Type</td>
			<td>
				<output id="camera_type"></output>
			</td>
		</tr>
		<tr>
			<td>Frequency</td>
			<td>
				<output id="camera_frequency"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>SD Card</h3>
		</tr>
		<tr>
			<td>Name</td>
			<td>
				<output id="sd_name"></output>
			</td>
		</tr>
		<tr>
			<td>Manufacturer</td>
			<td>
				<output id="sd_manufacturer"></output>
			</td>
		</tr>
		<tr>
			<td>Capacity</td>
			<td>
				<output id="sd_capacity"></output>
			</td>
		</tr>
		<tr>
			<td>Sector Size</td>
			<td>
				<output id="sd_sector_size"></output>
			</td>
		</tr>
		<tr>
			<td>Partition Allocation Size</td>
			<td>
				<output id="sd_partition_alloc_size"></output>
			</td>
		</tr>
		<tr>
			<td>Partition Size</td>
			<td>
				<output id="sd_partition_size"></output>
			</td>
		</tr>
		<tr>
			<td>Partition Free Space</td>	
			<td>
				<output id="sd_partition_free"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>			
			<h3>Memory</h3>
		</tr>
		<tr>
			<td>Total Free (Int + Ext)</td>	
			<td>
				<output id="heap_total_free"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Free</td>	
			<td>
				<output id="heap_spiram_free"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Largest Free Block</td>	
			<td>
				<output id="heap_spiram_largest_free"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Min Free</td>	
			<td>
				<output id="heap_spiram_min_free"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Free</td>	
			<td>
				<output id="heap_internal_free"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Largest Free Block</td>	
			<td>
				<output id="heap_internal_largest_free"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Min Free</td>	
			<td>
				<output id="heap_internal_min_free"></output>
			</td>
		</tr>
	</table>


	<table>
		<colgroup>
			<col span="1" style="width: 35%;">
			<col span="1" style="width: 65%;">
		</colgroup>
		<tr>
			<h3>Build</h3>
		</tr>
		<tr>
			<td>Firmware Version</td>
			<td>
				<output id="firmware_version"></output>
			</td>
		</tr>
		<tr>
			<td>Firmware Build Time</td>
			<td>
				<output id="build_time"></output>
			</td>
		</tr>
		<tr>
			<td>Web Interface Version</td>
			<td>
				<output id="html_version"></output>
			</td>
		</tr>
		<tr>
			<td>Config File Version</td>
			<td>
				<output id="config_file_version"></output>
			</td>
		</tr>
		<tr>
			<td>ESP-IDF Version</td>
			<td>
				<output id="idf_version"></output>
			</td>
		</tr>
	</table>

	<table>
		<tr>
			<h3>Copyright</h3>
		</tr>
		<tr>
			<td>
				Copyright &copy; 2020 - 2024 by <a href="https://github.com/jomjol/AI-on-the-edge-device" target=_blank>Jomjol</a> and others<br>
				Remark: This is a forked version by <a href="https://github.com/Slider0007/AI-on-the-edge-device" target=_blank>Slider0007</a>
			</td>
		</tr>
</body>
</html>


<script type="text/javascript">
	function loadInfoData() 
	{
		url = getDomainname() + '/info';     
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				const _jsonData = JSON.parse(xhttp.responseText);			
				document.getElementById("process_status").value = _jsonData.process_status;
				if (_jsonData.process_status.substr(0,10) == "Processing")
					addClassToElement("process_status", "badge-success");
				else
					addClassToElement("process_status", "badge-error");

				document.getElementById("process_interval").value = _jsonData.process_interval + " Minutes";
				document.getElementById("process_time").value = _jsonData.process_time + " Seconds";
				document.getElementById("cycle_counter").value = _jsonData.cycle_counter;
				
				document.getElementById("datalogging_sdcard_status").value = _jsonData.datalogging_sdcard_status;
				if (_jsonData.datalogging_sdcard_status == "Enabled")
					addClassToElement("datalogging_sdcard_status", "badge-success");
				else if (_jsonData.datalogging_sdcard_status == "Disabled")
					addClassToElement("datalogging_sdcard_status", "badge-disabled");
				else {
					document.getElementById("datalogging_sdcard_status").value += " (Unknown Status)"
					addClassToElement("datalogging_sdcard_status", "badge-error");
				}

				document.getElementById("mqtt_status").value = _jsonData.mqtt_status;
				if (_jsonData.mqtt_status.substring(0,9) == "Connected")
					addClassToElement("mqtt_status", "badge-success");
				else if (_jsonData.mqtt_status == "Disconnected")
					addClassToElement("mqtt_status", "badge-error");
				else if (_jsonData.mqtt_status == "Disabled")
					addClassToElement("mqtt_status", "badge-disabled");
				else {
					document.getElementById("mqtt_status").value += " (Unknown Status)"
					addClassToElement("mqtt_status", "badge-error");
				}

				document.getElementById("influxdbv1_status").value = _jsonData.influxdbv1_status;
				if (_jsonData.influxdbv1_status.substring(0,7) == "Enabled")
					addClassToElement("influxdbv1_status", "badge-success");
				else if (_jsonData.influxdbv1_status == "Disabled")
					addClassToElement("influxdbv1_status", "badge-disabled");
				else {
					document.getElementById("influxdbv1_status").value += " (Unknown Status)"
					addClassToElement("influxdbv1_status", "badge-error");
				}
				
				document.getElementById("influxdbv2_status").value = _jsonData.influxdbv2_status;
				if (_jsonData.influxdbv2_status.substring(0,7) == "Enabled")
					addClassToElement("influxdbv2_status", "badge-success");
				else if (_jsonData.influxdbv2_status == "Disabled")
					addClassToElement("influxdbv2_status", "badge-disabled");
				else {
					document.getElementById("influxdbv2_status").value += " (Unknown Status)"
					addClassToElement("influxdbv2_status", "badge-error");
				}

				document.getElementById("ntp_syncstatus").value = _jsonData.ntp_syncstatus
				if (_jsonData.ntp_syncstatus == "Synchronized")
					addClassToElement("ntp_syncstatus", "badge-success");
				else if (_jsonData.ntp_syncstatus == "Not Synchronized")
					addClassToElement("ntp_syncstatus", "badge-warning");
				else if (_jsonData.ntp_syncstatus == "Disabled")
					addClassToElement("ntp_syncstatus", "badge-disabled");
				else {
					document.getElementById("ntp_syncstatus").value += " (Unknown Status)"
					addClassToElement("ntp_syncstatus", "badge-error");
				}

				//Input format (ISO): 2023-10-23T14:26:34+0200
				document.getElementById("device_starttime").value = _jsonData.device_starttime.substr(0,10) + " " +
																	 _jsonData.device_starttime.substr(11,8) + " (UTC" +	
																	 _jsonData.device_starttime.substr(19,5) + ")";
				
				//Input format (ISO): 2023-10-23T14:26:34+0200
				document.getElementById("current_time").value = _jsonData.current_time.substr(0,10) + " " +
												_jsonData.current_time.substr(11,8) + " (UTC" +	
												_jsonData.current_time.substr(19,5) + ")";	

				document.getElementById("device_uptime").value = formatUptime(_jsonData.device_uptime);
	
				document.getElementById("wlan_status").value = _jsonData.wlan_status;
				if (_jsonData.wlan_status == "Connected")
					addClassToElement("wlan_status", "badge-success");
				else
					addClassToElement("wlan_status", "badge-error");

				document.getElementById("wlan_ssid").value = _jsonData.wlan_ssid;
				document.getElementById("wlan_rssi").value = _jsonData.wlan_rssi + " dBm";
				document.getElementById("mac_address").value = _jsonData.mac_address;
				document.getElementById("network_config").value = _jsonData.network_config;
				document.getElementById("ipv4_address").value = _jsonData.ipv4_address;
				document.getElementById("netmask_address").value = _jsonData.netmask_address;
				document.getElementById("gateway_address").value = _jsonData.gateway_address;
				document.getElementById("dns_address").value = _jsonData.dns_address;			
				document.getElementById("hostname").value =_jsonData.hostname;

				document.getElementById("board_type").value = _jsonData.board_type;
				document.getElementById("chip_model").value = _jsonData.chip_model;
				document.getElementById("chip_cores").value = _jsonData.chip_cores;
				document.getElementById("chip_revision").value = _jsonData.chip_revision;
				document.getElementById("chip_frequency").value = _jsonData.chip_frequency + " Mhz";
				document.getElementById("chip_temp").value = _jsonData.chip_temp + " Â°C";

				document.getElementById("camera_type").value = _jsonData.camera_type;
				document.getElementById("camera_frequency").value = _jsonData.camera_frequency + "  Mhz";
				
				document.getElementById("sd_name").value = _jsonData.sd_name;
				document.getElementById("sd_manufacturer").value = _jsonData.sd_manufacturer;
				document.getElementById("sd_capacity").value = _jsonData.sd_capacity + " MB";
				document.getElementById("sd_sector_size").value = _jsonData.sd_sector_size + " byte";
				document.getElementById("sd_partition_alloc_size").value = _jsonData.sd_partition_alloc_size + " byte";
				document.getElementById("sd_partition_size").value = _jsonData.sd_partition_size + " MB";
				document.getElementById("sd_partition_free").value = _jsonData.sd_partition_free + " MB";

				document.getElementById("heap_total_free").value = _jsonData.heap_total_free + " byte";
				document.getElementById("heap_internal_free").value = _jsonData.heap_internal_free + " byte";
				document.getElementById("heap_internal_largest_free").value = _jsonData.heap_internal_largest_free + " byte";
				document.getElementById("heap_internal_min_free").value = _jsonData.heap_internal_min_free + " byte";
				document.getElementById("heap_spiram_free").value = _jsonData.heap_spiram_free + " byte";
				document.getElementById("heap_spiram_largest_free").value = _jsonData.heap_spiram_largest_free + " byte";
				document.getElementById("heap_spiram_min_free").value = _jsonData.heap_spiram_min_free + " byte";

				const FirmwareVersionSplit = _jsonData.firmware_version.split('Commit: ');
				const FirmwareVersionCommit = FirmwareVersionSplit[1].substring(0, 7);
				const FirmwareVersionString = FirmwareVersionSplit[0] + "Commit: <a href=\"https://github.com/Slider0007/AI-on-the-edge-device/commits/" + 
										FirmwareVersionCommit + "\" target=\"_blank\">" + FirmwareVersionCommit + "</a>)";
				document.getElementById("firmware_version").innerHTML = FirmwareVersionString;
				
				//Input format (ISO): 2023-10-23T14:26:34+0000
				document.getElementById("build_time").value = _jsonData.build_time.substr(0,10) + " " +
												 _jsonData.build_time.substr(11,8) + " (UTC" +	
												 _jsonData.build_time.substr(19,5) + ")";
				
				const HTMLVersionSplit = _jsonData.html_version.split('Commit: ');
				const HTMLVersionCommit = HTMLVersionSplit[1].substring(0, 7);
				const HTMLVersionString = HTMLVersionSplit[0] + "Commit: <a href=\"https://github.com/Slider0007/AI-on-the-edge-device/commits/" + 
									HTMLVersionCommit + "\" target=\"_blank\">" + HTMLVersionCommit + "</a>)";
				document.getElementById("html_version").innerHTML = HTMLVersionString;
				document.getElementById("config_file_version").value = _jsonData.config_file_version;

				document.getElementById("idf_version").value = _jsonData.idf_version;
			}
		};

		xhttp.timeout = 10000; // 10 Seconds
		xhttp.open("GET", url, true);
		xhttp.send();
	}


	function addClassToElement(_element, _class)
	{
		var element = document.getElementById(_element);
		element.classList.add(_class);
	}


	function init()
	{
		loadInfoData();
	}

	init();

</script>

</body>
</html>