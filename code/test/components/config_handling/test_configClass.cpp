#include "configClass.h"

static const char *TAG_CFGTEST = "CONFIG_TEST";


/**
* @brief Test JSON parse and serialization
*
* Be aware: The results are depending on the device for which it's compiled (GPIO section derived from hardware config).
*/
void test_configJsonParseAndSerialization()
{
    /* @TODO: Possible to add without embedded files having an additional environment or only add for test environment?
    *  1. Needs to be added to platformio.ini:
            board_build.embed_txtfiles = list of files
    *  2. Needs to be added to CMakeList.txt of component:
    *       EMBED_TXTFILES config_json_default_expected.txt
    *                       config_json_high_limit_expected.txt
    *                       config_json_high_limit.txt
    *                       config_json_low_limit_expected.txt
    *                       config_json_low_limit.txt
    *                       config_json_special_expected.txt
    *                       config_json_special.txt
    * Workaround: Add content as string into code

    // Embedded file: Default config
    extern const char config_json_default_expected_start[] asm("_binary_config_json_default_expected_txt_start");
    extern const char config_json_default_expected_end[] asm("_binary_config_json_default_expected_txt_end");

    // Embedded file: Config to check high limits
    extern const char config_json_high_limit_expected_start[] asm("_binary_config_json_high_limit_expected_txt_start");
    extern const char config_json_high_limit_expected_end[] asm("_binary_config_json_high_limit_expected_txt_end");
    extern const char config_json_high_limit_start[] asm("_binary_config_json_high_limit_txt_start");
    extern const char config_json_high_limit_end[] asm("_binary_config_json_high_limit_txt_end");

    // Embedded file: Config to check low limits
    extern const char config_json_low_limit_expected_start[] asm("_binary_config_json_low_limit_expected_txt_start");
    extern const char config_json_low_limit_expected_end[] asm("_binary_config_json_low_limit_expected_txt_end");
    extern const char config_json_low_limit_start[] asm("_binary_config_json_low_limit_txt_start");
    extern const char config_json_low_limit_end[] asm("_binary_config_json_low_limit_txt_end");

    // Embedded file: Config to check special validation handlings
    extern const char config_json_special_expected_start[] asm("_binary_ config_json_special_expected_txt_start");
    extern const char config_json_special_expected_end[] asm("_binary_ config_json_special_expected_txt_end");
    extern const char config_json_special_start[] asm("_binary_ config_json_special_txt_start");
    extern const char config_json_special_end[] asm("_binary_config_json_special_txt_end");
    */

    // Check default values (ESP32CAM device)
    ESP_LOGI(TAG_CFGTEST, "TEST 1: Check default values");
    std::string cfgDataExpexcted = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":-1,\"automaticprocessinterval\":\"1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":2000,\"flashintensity\":50},\"camera\":{\"camerafrequency\":20,\"imagequality\":12,\"imagesize\":\"VGA\",\"brightness\":0,\"contrast\":0,\"saturation\":0,\"sharpness\":0,\"exposurecontrolmode\":1,\"autoexposurelevel\":0,\"manualexposurevalue\":300,\"gaincontrolmode\":1,\"manualgainvalue\":0,\"specialeffect\":0,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":0,\"zoomoffsetx\":0,\"zoomoffsety\":0},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":3}},\"imagealignment\":{\"alignmentalgo\":0,\"searchfield\":{\"x\":20,\"y\":20},\"imagerotation\":\"0.0\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"0.00\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":0,\"analogdigitsyncvalue\":\"9.2\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":1,\"maxrate\":\"0.150\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":720}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"processdatanotation\":0,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":1,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":1,\"token\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":2,\"logfilesretention\":5,\"debugfilesretention\":5},\"data\":{\"enabled\":false,\"datafilesretention\":30}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":0,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":-75}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":160},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":5},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":60}}}}";
    //std::string cfgDataExpexcted(config_json_default_expected_start, config_json_default_expected_end - config_json_default_expected_start);
    ConfigClass::getInstance()->readConfigFile(true); // Use default config
    TEST_ASSERT_EQUAL_STRING(cfgDataExpexcted.c_str(), ConfigClass::getInstance()->getJsonBuffer());

    // Check low limit boundery correction (ESP32CAM device)
    ESP_LOGI(TAG_CFGTEST, "TEST 2: Check low limit boundery correction");
    std::string cfgData = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":-2,\"automaticprocessinterval\":\"-1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":-100,\"flashintensity\":-1},\"camera\":{\"camerafrequency\":-20,\"imagequality\":-12,\"imagesize\":\"VGA\",\"brightness\":-3,\"contrast\":-3,\"saturation\":-3,\"sharpness\":-5,\"exposurecontrolmode\":-1,\"autoexposurelevel\":-3,\"manualexposurevalue\":-1,\"gaincontrolmode\":-1,\"manualgainvalue\":-1,\"specialeffect\":-1,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":-1,\"zoomoffsetx\":-1,\"zoomoffsety\":-1},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":-3}},\"imagealignment\":{\"alignmentalgo\":-1,\"searchfield\":{\"x\":-20,\"y\":-20},\"imagerotation\":\"-189.9\",\"flipimagesize\":false,\"marker\":[{\"x\":0,\"y\":0},{\"x\":-1,\"y\":-1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"-0.10\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":-3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":-3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":-10,\"analogdigitsyncvalue\":\"5.9\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":-1,\"maxrate\":\"0.000\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":-1}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":-1,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"processdatanotation\":-1,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":-1,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":-1,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":-1,\"token\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":-1,\"pwmfrequency\":-1,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":-1,\"quantity\":0,\"colorredchannel\":-1,\"colorgreenchannel\":-1,\"colorbluechannel\":-1},\"intensitycorrectionfactor\":-1},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":-1,\"logfilesretention\":-1,\"debugfilesretention\":-1},\"data\":{\"enabled\":false,\"datafilesretention\":-1}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":-1,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":-101}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":159},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":-1},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":-1}}}}";
    //cfgData(config_json_low_limit_start, config_json_low_limit_end - config_json_low_limit_start);
    cfgDataExpexcted = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":-1,\"automaticprocessinterval\":\"0.1\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":100,\"flashintensity\":0},\"camera\":{\"camerafrequency\":5,\"imagequality\":8,\"imagesize\":\"VGA\",\"brightness\":-2,\"contrast\":-2,\"saturation\":-2,\"sharpness\":-4,\"exposurecontrolmode\":0,\"autoexposurelevel\":-2,\"manualexposurevalue\":0,\"gaincontrolmode\":0,\"manualgainvalue\":0,\"specialeffect\":0,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":0,\"zoomoffsetx\":0,\"zoomoffsety\":0},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":0}},\"imagealignment\":{\"alignmentalgo\":0,\"searchfield\":{\"x\":1,\"y\":1},\"imagerotation\":\"-180.0\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"0.00\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":0}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":0}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":-9,\"analogdigitsyncvalue\":\"6.0\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":0,\"maxrate\":\"0.001\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":0}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"processdatanotation\":0,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":0,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":0,\"token\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":0,\"pwmfrequency\":5,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":0,\"colorgreenchannel\":0,\"colorbluechannel\":0},\"intensitycorrectionfactor\":1},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":1,\"logfilesretention\":0,\"debugfilesretention\":0},\"data\":{\"enabled\":false,\"datafilesretention\":0}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":0,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":-100}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":160},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":1},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":1}}}}";    ConfigClass::getInstance()->readConfigFile(true, cfgData);
    //cfgDataExpexcted(config_json_high_limit_expected_start, config_json_high_limit_expected_end - config_json_high_limit_expected_start);
    TEST_ASSERT_EQUAL_STRING(cfgDataExpexcted.c_str(), ConfigClass::getInstance()->getJsonBuffer());

    // Check high limit boundery correction
    ESP_LOGI(TAG_CFGTEST, "TEST 3: Check high limit boundery correction");
    cfgData = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":2,\"automaticprocessinterval\":\"1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":2000,\"flashintensity\":101},\"camera\":{\"camerafrequency\":21,\"imagequality\":64,\"imagesize\":\"VGA\",\"brightness\":3,\"contrast\":3,\"saturation\":3,\"sharpness\":4,\"exposurecontrolmode\":2,\"autoexposurelevel\":5,\"manualexposurevalue\":1300,\"gaincontrolmode\":2,\"manualgainvalue\":1500,\"specialeffect\":10,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":4,\"zoomoffsetx\":1000,\"zoomoffsety\":1000},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":3}},\"imagealignment\":{\"alignmentalgo\":5,\"searchfield\":{\"x\":20,\"y\":20},\"imagerotation\":\"189.9\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"1.10\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":10,\"analogdigitsyncvalue\":\"10.0\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":4,\"maxrate\":\"0.150\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":720}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":3,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"processdatanotation\":3,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":12,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":3,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":3,\"token\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":5001,\"pwmfrequency\":1000001,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":8,\"quantity\":0,\"colorredchannel\":256,\"colorgreenchannel\":256,\"colorbluechannel\":256},\"intensitycorrectionfactor\":101},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":5,\"logfilesretention\":5,\"debugfilesretention\":5},\"data\":{\"enabled\":false,\"datafilesretention\":30}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":2,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":1}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":241},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":5},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":60}}}}";
    //cfgData(config_json_high_limit_start, config_json_high_limit_end - config_json_high_limit_start);
    cfgDataExpexcted = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":1,\"automaticprocessinterval\":\"1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":2000,\"flashintensity\":100},\"camera\":{\"camerafrequency\":20,\"imagequality\":63,\"imagesize\":\"VGA\",\"brightness\":2,\"contrast\":2,\"saturation\":2,\"sharpness\":3,\"exposurecontrolmode\":2,\"autoexposurelevel\":2,\"manualexposurevalue\":1200,\"gaincontrolmode\":1,\"manualgainvalue\":5,\"specialeffect\":7,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":2,\"zoomoffsetx\":960,\"zoomoffsety\":720},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":3}},\"imagealignment\":{\"alignmentalgo\":4,\"searchfield\":{\"x\":20,\"y\":20},\"imagerotation\":\"180.0\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"1.00\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":9,\"analogdigitsyncvalue\":\"9.9\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":2,\"maxrate\":\"0.150\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":720}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":2,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"processdatanotation\":2,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":10,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":2,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":2,\"token\":\"\",\"tls\":{\"cacert\":\"\",\"clientcert\":\"\",\"clientkey\":\"\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"\",\"fieldkey1\":\"\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":5000,\"pwmfrequency\":1000000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":5,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":4,\"logfilesretention\":5,\"debugfilesretention\":5},\"data\":{\"enabled\":false,\"datafilesretention\":30}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":0,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":0}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":240},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":5},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":60}}}}";
    //cfgDataExpexcted(config_json_special_expected_start, config_json_special_expected_end - config_json_special_expected_start);
    ConfigClass::getInstance()->readConfigFile(true, cfgData);
    TEST_ASSERT_EQUAL_STRING(cfgDataExpexcted.c_str(), ConfigClass::getInstance()->getJsonBuffer());

    // Check special input validation
    ESP_LOGI(TAG_CFGTEST, "TEST 4: Check special input validation");
    cfgData = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":-1,\"automaticprocessinterval\":\"1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":2000,\"flashintensity\":50},\"camera\":{\"camerafrequency\":20,\"imagequality\":12,\"imagesize\":\"VGA\",\"brightness\":0,\"contrast\":0,\"saturation\":0,\"sharpness\":0,\"exposurecontrolmode\":1,\"autoexposurelevel\":0,\"manualexposurevalue\":300,\"gaincontrolmode\":1,\"manualgainvalue\":0,\"specialeffect\":0,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":0,\"zoomoffsetx\":0,\"zoomoffsety\":0},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source/\",\"rawimagesretention\":3}},\"imagealignment\":{\"alignmentalgo\":0,\"searchfield\":{\"x\":20,\"y\":20},\"imagerotation\":\"0.0\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"0.00\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit/\",\"roiimagesretention\":3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog/\",\"roiimagesretention\":3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":0,\"analogdigitsyncvalue\":\"9.2\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":1,\"maxrate\":\"0.150\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":720}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"/watermeter/\",\"clientid\":\"123456789012345678901234\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"/client.key\",\"clientcert\":\"/client.crt\",\"clientkey\":\"/client.key\"},\"processdatanotation\":0,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"/homeassistant/\",\"statustopic\":\"/homeassistant/status/\",\"metertype\":1,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"/client.key\",\"clientcert\":\"/client.crt\",\"clientkey\":\"/client.key\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"/test/\",\"fieldkey1\":\"/test/\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":1,\"token\":\"\",\"tls\":{\"cacert\":\"/client.key\",\"clientcert\":\"/client.crt\",\"clientkey\":\"/client.key\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"/test/\",\"fieldkey1\":\"/test/\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":2,\"logfilesretention\":5,\"debugfilesretention\":5},\"data\":{\"enabled\":false,\"datafilesretention\":30}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":0,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":-75}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":160},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":5},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":60}}}}";
    //cfgData(config_json_special_start, config_json_special_end - config_json_special_start);
    cfgDataExpexcted = "{\"config\":{\"version\":3,\"lastmodified\":\"\"},\"operationmode\":{\"opmode\":-1,\"automaticprocessinterval\":\"1.0\",\"usedemoimages\":false},\"takeimage\":{\"flashlight\":{\"flashtime\":2000,\"flashintensity\":50},\"camera\":{\"camerafrequency\":20,\"imagequality\":12,\"imagesize\":\"VGA\",\"brightness\":0,\"contrast\":0,\"saturation\":0,\"sharpness\":0,\"exposurecontrolmode\":1,\"autoexposurelevel\":0,\"manualexposurevalue\":300,\"gaincontrolmode\":1,\"manualgainvalue\":0,\"specialeffect\":0,\"mirrorimage\":false,\"flipimage\":false,\"zoommode\":0,\"zoomoffsetx\":0,\"zoomoffsety\":0},\"debug\":{\"saverawimages\":false,\"rawimageslocation\":\"/log/source\",\"rawimagesretention\":3}},\"imagealignment\":{\"alignmentalgo\":0,\"searchfield\":{\"x\":20,\"y\":20},\"imagerotation\":\"0.0\",\"flipimagesize\":false,\"marker\":[{\"x\":1,\"y\":1},{\"x\":1,\"y\":1}],\"debug\":{\"savedebuginfo\":false}},\"numbersequences\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\"}]},\"digit\":{\"enabled\":true,\"model\":\"dig-class100_0168_s2_q.tflite\",\"cnngoodthreshold\":\"0.00\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/digit\",\"roiimagesretention\":3}},\"analog\":{\"enabled\":true,\"model\":\"ana-class100_0171_s1_q.tflite\",\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"roi\":[]}],\"debug\":{\"saveroiimages\":false,\"roiimageslocation\":\"/log/analog\",\"roiimagesretention\":3}},\"postprocessing\":{\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"decimalshift\":0,\"analogdigitsyncvalue\":\"9.2\",\"extendedresolution\":true,\"ignoreleadingnan\":false,\"checkdigitincreaseconsistency\":false,\"maxratechecktype\":1,\"maxrate\":\"0.150\",\"allownegativerate\":false,\"usefallbackvalue\":true,\"fallbackvalueagestartup\":720}],\"debug\":{\"savedebuginfo\":false}},\"mqtt\":{\"enabled\":false,\"uri\":\"\",\"maintopic\":\"watermeter\",\"clientid\":\"watermeter\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"client.key\",\"clientcert\":\"client.crt\",\"clientkey\":\"client.key\"},\"processdatanotation\":0,\"retainprocessdata\":false,\"homeassistant\":{\"discoveryenabled\":false,\"discoveryprefix\":\"homeassistant\",\"statustopic\":\"homeassistant/status\",\"metertype\":1,\"retaindiscovery\":false}},\"influxdbv1\":{\"enabled\":false,\"uri\":\"\",\"database\":\"\",\"authmode\":0,\"username\":\"\",\"password\":\"\",\"tls\":{\"cacert\":\"client.key\",\"clientcert\":\"client.crt\",\"clientkey\":\"client.key\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"test\",\"fieldkey1\":\"test\"}]},\"influxdbv2\":{\"enabled\":false,\"uri\":\"\",\"bucket\":\"\",\"organization\":\"\",\"authmode\":1,\"token\":\"\",\"tls\":{\"cacert\":\"client.key\",\"clientcert\":\"client.crt\",\"clientkey\":\"client.key\"},\"sequence\":[{\"sequenceid\":0,\"sequencename\":\"main\",\"measurementname\":\"test\",\"fieldkey1\":\"test\"}]},\"gpio\":{\"customizationenabled\":false,\"gpiopin\":[{\"gpionumber\":1,\"gpiousage\":\"restricted: uart0-tx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":3,\"gpiousage\":\"restricted: uart0-rx\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":4,\"gpiousage\":\"flashlight-pwm\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"flashlight-default\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":12,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100},{\"gpionumber\":13,\"gpiousage\":\"spare\",\"pinenabled\":false,\"pinname\":\"\",\"pinmode\":\"input\",\"capturemode\":\"cyclic-polling\",\"inputdebouncetime\":200,\"pwmfrequency\":5000,\"exposetomqtt\":false,\"exposetorest\":false,\"smartled\":{\"type\":0,\"quantity\":1,\"colorredchannel\":255,\"colorgreenchannel\":255,\"colorbluechannel\":255},\"intensitycorrectionfactor\":100}]},\"log\":{\"debug\":{\"loglevel\":2,\"logfilesretention\":5,\"debugfilesretention\":5},\"data\":{\"enabled\":false,\"datafilesretention\":30}},\"network\":{\"wlan\":{\"ssid\":\"\",\"password\":\"\",\"hostname\":\"watermeter\",\"ipv4\":{\"networkconfig\":0,\"ipaddress\":\"\",\"subnetmask\":\"\",\"gatewayaddress\":\"\",\"dnsserver\":\"\"},\"wlanroaming\":{\"enabled\":false,\"rssithreshold\":-75}},\"time\":{\"timezone\":\"CET-1CEST,M3.5.0,M10.5.0/3\",\"ntp\":{\"timesyncenabled\":true,\"timeserver\":\"\",\"processstartinterlock\":true}}},\"system\":{\"cpufrequency\":160},\"webui\":{\"autorefresh\":{\"overviewpage\":{\"enabled\":true,\"refreshtime\":5},\"datagraphpage\":{\"enabled\":false,\"refreshtime\":60}}}}";
    //cfgDataExpexcted(config_json_special_expected_start, config_json_special_expected_end - config_json_special_expected_start);
    ConfigClass::getInstance()->readConfigFile(true, cfgData);
    TEST_ASSERT_EQUAL_STRING(cfgDataExpexcted.c_str(), ConfigClass::getInstance()->getJsonBuffer());
}

/**
 * @brief test config handling
 */
void test_configHandling()
{
  test_configJsonParseAndSerialization();
}